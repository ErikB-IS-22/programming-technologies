# Лабораторная работа №1. Знакомство с OpenAI API. Написание простого текстового ассистента

## Цель лабораторной работы

Научиться работать с OpenAI API, чтобы создать простого текстового ассистента, который может отвечать на вопросы. 

---

## Подготовка к выполнению задания

Ввиду того, что OpenAI API недоступен в России, была использована альтернатива https://ai.io.net с моделью `deepseek-ai/DeepSeek-R1-0528`. Перед началом рабо-ты было создано и активировано виртуальное окружение (рис. 1). 

<img width="948" height="63" alt="image" src="https://github.com/user-attachments/assets/c36d38e7-6883-45b5-a199-c3a59b840bc8" />

Рисунок 1 – Создание виртуального окружения

На сайте https://ai.io.net был создан API-ключ для работы с моделью (рис. 2). Был создан файл .env для безопасного хранения API-ключа. Также файл `.env` был добавлен в `.gitignore`, чтобы ключ не был загружен в репозито-рий. Был создан файл `requirements.txt` и применена команда `pip freeze > requirements.txt`, чтобы сохранить список зависимостей (рис. 3).

<img width="974" height="522" alt="image" src="https://github.com/user-attachments/assets/6f1feef1-c2b8-4127-b128-984907975827" />

Рисунок 2 – Создание API-ключа

<img width="393" height="721" alt="image" src="https://github.com/user-attachments/assets/2487317b-91de-43b4-95c7-01dab09c4836" />

Рисунок 3 – Список зависимостей

Далее был создан файл `main.py` и написан базовый код. Здесь идёт обращение к URL для доступа к API (url), обращение к модели (model), установка системных промптов (messages) и получение API-ключа (Authorization) (рис. 4). Был таже написан код для интерактивного общения, чтобы пользователь мог общаться с нейросетью. Данный код работает так (рис. 5):

* Программа запустится, только если её вызвать напрямую;
* Показываем пользователю подсказку;
* Запускаем бесконечный цикл общения;
* Если введено exit – выходим;
* Иначе отправляем запрос в API и выводим ответ.

<img width="905" height="839" alt="image" src="https://github.com/user-attachments/assets/92f1596c-3881-45d2-8225-86bfcc04a6a7" />

Рисунок 4 – Базовый код для обращению к API

<img width="675" height="240" alt="image" src="https://github.com/user-attachments/assets/2d42c8a6-68dd-41d7-8e6f-9fa1bfd890dd" />

Рисунок 5 – Базовый код для обращению к API

---

## Выполнение задания

Были выполнены следующие задания лабораторной работы:

1.	Реализовать использование системного промпта через переменную окружения `.env`, либо через ручной ввод/выбор промпта и его сохраниение в базу данных при выборе соответствующей опции в терминале;
2.	Проверить разные значения параметра temperature в настройках языковой модели, проанализировать поведение языковой модели, результат отразить в отчёте;
3.	Реализовать ведение истории диалога (контекста переписки с ассистентом), чтобы ИИ помнил, о чём пользователь с ним разговаривал. Длину истории сообщений ограничить до 6 последних сообщений (3 пользовательских, 3 от ИИ).

### Задание 1

Для выполнения первого задания код был доработан. Был добавлен файл `database.py` для инициализации базы данных SQLite `system_prompts` с помощью SQLAlchemy для повышенной безопасности базы данных и защиты от SQL-инъекций в классе `SystemPrompt`, в котором присутствуют столбцы с системным промптом и его названием, а также булеан для обозначения активности промпта (рис. 6). Далее был создан файл `system_prompt_manager.py` (рис. 7) для управления системными промптами. В нём присутствуют следующие функции:

* `save_system_prompt(name, content)` – Сохранение системного промпта;
* `get_active_system_prompt()` – Получение активного системного промпта;
* `manage_system_prompts()` – Управление системными промптами;
* `view_prompts()` – Просмотр сохранённых промптов;
* `add_prompt()` – Добавление нового системного промпта;
* `activate_prompt()` – Активировать системный промпт.

Был установлен и активирован системный промпт `«You are Erik»` (рис. 8). После доработки программа была проверена с помощью простых промптов. Видно, что промпт действительно сохраняется в базу данных (рис. 9), а нейросеть действительно представляет себя, как Erik (рис. 10).

<img width="973" height="455" alt="image" src="https://github.com/user-attachments/assets/9f1be342-143c-4262-8ee9-188fd5f959a4" />

Рисунок 6 - Класс `SystemPrompt` в файле `database.py`

<img width="1792" height="5040" alt="code" src="https://github.com/user-attachments/assets/f448e503-626d-4e03-be1e-a86801b417f9" />

Рисунок 7 - Файл `system_prompt_manager.py`

<img width="876" height="733" alt="image" src="https://github.com/user-attachments/assets/4834c93c-c14a-4a21-9e0e-272f48bb4a4d" />

Рисунок 8 - Установка и активация системного промпта

<img width="939" height="373" alt="image" src="https://github.com/user-attachments/assets/e791597e-fd69-4a18-ad01-b22b8f8cbfa5" />

Рисунок 9 - Запись системного промпта в базе данных

<img width="974" height="489" alt="image" src="https://github.com/user-attachments/assets/f5afb9b9-c9c4-40d7-aafa-8129f5ce6f24" />

Рисунок 10 - Проверка работы промпта через диалог

### Задание 2

Также был добавлен параметр `temperature`. При установлении значений ниже 1, изменений в работе нейросети не наблюдалось, однако при установлении значений выше 1 нейросеть обрабатывала промпт бесконечно долго.

### Задание 3

Для выполнения третьего задания в файле `database.py` был добавлен класс `ChatMessage` (рис. 11), в котором присутствуют роль (пользователь или ИИ), текст, а также время отправки запроса. Тажке был создан файл `chat_history_manager.py` (рис. 12), в котором присутствуют следующие функции:

* `save_message(role, content)` – Сохранение сообщения в историю;
* `get_recent_history()` – Получение последних 6 сообщений (3 пользователя + 3 ассистента);
* `clear_history()` – Очистка истории диалога;

<img width="974" height="435" alt="image" src="https://github.com/user-attachments/assets/c2520ada-56a3-4883-af6d-a74e8d69868e" />

Рисунок 10 - Класс `ChatMessage` в файле `database.py`

<img width="1792" height="1658" alt="code" src="https://github.com/user-attachments/assets/74270963-1888-4a06-96cb-95542dfd323c" />

Рисунок 11 - Файл `chat_history_manager.py`

<img width="315" height="430" alt="image" src="https://github.com/user-attachments/assets/5fdfcd4c-c69e-4a4c-974c-40968c4f5364" />







Рисунок 6 – Установка нового системного промпта

<img width="974" height="335" alt="image" src="https://github.com/user-attachments/assets/3b3f043f-b5f7-4400-bd39-b65530258d20" />
<img width="974" height="610" alt="image" src="https://github.com/user-attachments/assets/f87ba763-e122-429b-bd6a-346b3fd7cf85" />
<img width="974" height="595" alt="image" src="https://github.com/user-attachments/assets/54f440f2-eb5a-4506-be3e-877f7d806921" />
<img width="974" height="598" alt="image" src="https://github.com/user-attachments/assets/0b7705a5-7389-4b95-9eef-5dea49359ea9" />
<img width="974" height="199" alt="image" src="https://github.com/user-attachments/assets/976a6535-34a7-47df-9192-6bc60092cc4a" />

Рисунок 7 – Проверка нейросети после доработки кода

<img width="856" height="327" alt="{9156EB30-28FC-4F96-B778-E152B9D079F0}" src="https://github.com/user-attachments/assets/2b58c406-c7a9-4ed3-a951-d44072bd95bf" />

<img width="1537" height="482" alt="{BBD53735-4AB8-4F5C-B28B-9227463F785E}" src="https://github.com/user-attachments/assets/87b24f5e-9000-4a28-a57f-2d4822258630" />


---
